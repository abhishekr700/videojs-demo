<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Audio/Video Example - Record Plugin for Video.js</title>

    <!-- Get Video.js which provides the media player UI-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.5.5/video-js.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-record/3.8.0/css/videojs.record.min.css" rel="stylesheet">

    <!-- Get RecordRTC to support audio/video/GIF recording. -->
    <script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.5.5/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/6.1.1/adapter.min.js"></script>

    <!-- Get the recording plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-record/3.8.0/videojs.record.js"></script>


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <style>
        /* Change player background color */
        *{
            color: darkcyan;
        }

        a {
            color: rgb(4, 70, 70);
        }

        #myVideo {
            background-color: darkcyan;
        }

        #video-main {
            margin: auto;
            width: 50%;
            padding: 10px;
        }

        #heading {
            margin: auto;
            width: 50%;
            border: 4px solid darkcyan;
            padding: 10px;
        }
    </style>
</head>

<body>
    <!-- Create the preview video element -->
    <div class="container">
        <div class="row">
            <div class="col">
                <div id="heading">
                    <h2>Video.js Record Plugin Demo</h2>
                    <p>By <a href="https://github.com/abhishekr700">@abhishekr700</a></p>
                    <h4><a href="https://github.com/abhishekr700/videojs-demo">Code for this page</a></h4>
                    <p>Links:<br>
                        => <a href="https://github.com/videojs/video.js">Video.js</a> <br>
                        => <a href="https://github.com/collab-project/videojs-record">Video.js Record Plugin</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="video-main">
        <video id="myVideo" class="video-js vjs-default-skin"></video>  
    </div>

    <script>
        // You can specify maximum length of video here
        var videoMaxLengthInSeconds = 120;

        // Inialize the video player
        var player = videojs("myVideo", {
            controls: true,
            width: 720,
            height: 480,
            fluid: false,
            plugins: {
                record: {
                    audio: true,
                    video: true,
                    maxLength: videoMaxLengthInSeconds,
                    debug: true,
                    videoMimeType: "video/webm;codecs=H264"
                }
            }
        }, function () {
            // print version information at startup
            videojs.log(
                'Using video.js', videojs.VERSION,
                'with videojs-record', videojs.getPluginVersion('record'),
                'and recordrtc', RecordRTC.version
            );
        });

        // error handling for getUserMedia
        player.on('deviceError', function () {
            console.log('device error:', player.deviceErrorCode);
        });

        // Handle error events of the video player
        player.on('error', function (error) {
            console.log('error:', error);
        });

        // user clicked the record button and started recording !
        player.on('startRecord', function () {
            console.log('started recording! Do whatever you need to');
        });

        // user completed recording and stream is available
        // Upload the Blob to your server or download it locally !
        player.on('finishRecord', function () {

            // the blob object contains the recorded data that
            // can be downloaded by the user, stored on server etc.
            var videoBlob = player.recordedData.video;

            console.log('finished recording: ', videoBlob);
            player.record().saveAs({ 'video': 'my-video-file-name.webm' });
        });
    </script>
</body>

</html>